## 目标
- 提升代码可维护性与可读性，保持零依赖、原有功能不变
- 优化交互与可访问性，改善滚动与键盘体验
- 小幅度性能与健壮性优化（消息上限、合并样式）
- 所有新增/重构函数补充函数级注释（JSDoc）

## JavaScript 优化
- 提取 `updateRoleUI()`：统一处理角色切换的按钮文本、样式、`aria-pressed`（`script.js:19-24` 相关）
- 拆分事件函数：`onRoleToggle()`、`handleSend()`（保留）、`onInputKeyDown()`，职责更清晰（`script.js:19-24`、`51-59`）
- 将 `keypress` 改为 `keydown`，并忽略输入法合成中事件：`if (e.isComposing) return;`（`script.js:55`）
- 初始化时调用一次 `updateRoleUI()` 确保按钮状态与 `isRoleB` 同步（`script.js:13` 附近）
- 优化滚动：用 `messageArea.lastElementChild?.scrollIntoView({behavior:'smooth',block:'end'})` 替代 `scrollTop`（`script.js:36`）
- 增加消息上限 `MAX_MESSAGES`，超出时移除最早消息，避免长时间运行内存膨胀（`script.js:addMessage` 内）
- 所有函数加 JSDoc 注释，延续现有注释风格（`script.js` 全局）

## 可访问性与语义
- `#messageArea` 添加 `role="log"`、`aria-live="polite"`、`aria-relevant="additions"`（`index.html:12`）
- `#roleToggle` 同步 `aria-pressed`，按钮加 `type="button"`（`index.html:16`）
- `#sendButton` 加 `type="button"`，防止潜在表单提交（`index.html:15`）
- 输入框保留占位符并可考虑补充 `aria-label`（`index.html:14`）

## 健壮性与体验
- 保留 `trim()`，可进一步限制消息最大长度（例如 2000）并安全截断（`script.js:44-48`）
- 发送后将焦点回到输入框（已有），并确保不同输入法下 Enter 行为一致（`script.js:57` 改成 `keydown` 处理）

## CSS 小优化
- `.messages` 添加 `scroll-behavior: smooth`，与 JS 滚动一致（`style.css:50-56`）
- 合并按钮按压与阴影的重复样式，减少选择器重复（`style.css:147-176`）
- 增加 `@media (prefers-reduced-motion: reduce)` 降低动画与平滑滚动，提升可访问性（新增片段）

## 结构化封装（可选）
- 用模块模式（IIFE 或对象字面量）封装 `ChatApp`：状态（`isRoleB`）、方法（`addMessage`、`updateRoleUI`、事件绑定）
- 保持单文件、零依赖，方便后续扩展（如本地存储）

## 修改点清单（带位置）
- `script.js`：
  - 新增 `updateRoleUI()` 并在 `DOMContentLoaded` 初始化调用（`script.js:5-13` 附近、`19-24`）
  - `keypress` → `keydown` 并处理 `isComposing`（`script.js:55-59`）
  - `scrollTop` → `scrollIntoView`（`script.js:36`）
  - `addMessage()` 增加消息上限逻辑（`script.js:31-37`）
- `index.html`：
  - `#messageArea` 增加 ARIA 属性（`index.html:12`）
  - `#sendButton`、`#roleToggle` 增加 `type="button"`（`index.html:15-16`）
- `style.css`：
  - `.messages` 增加 `scroll-behavior`（`style.css:50-56`）
  - 合并按钮样式与 `prefers-reduced-motion` 片段（`style.css:147-180` 附近）

## 验证步骤
- 本地直接打开 `index.html`，测试：角色切换、发送按钮、键盘 Enter（含中文输入法）
- 检查滚动行为是否更平滑，可访问性检查（屏幕阅读器朗读新增消息）
- 连续发送 600 条消息，确认旧消息被移除且性能正常

## 交付约定
- 所有新增或重构函数均添加函数级注释（中文 JSDoc）
- 不引入任何新依赖，不改变现有文件结构
- 变更点保持最小原则，避免过度工程化
